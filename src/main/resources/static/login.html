<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">

    <title>Custom Login</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<div class="custom-login-container">
    <div class="custom-login-title">
        <h1>OrganizAI</h1>
    </div>
    <form id="loginForm" class="custom-login-form">
        <h2>Login</h2>
        <div class="input-container">
            <label for="email">Email</label>
            <input type="text" id="email" name="email" class="custom-input" required>
        </div>
        <div class="input-container">
            <label for="password">Senha</label>
            <input type="password" id="password" name="password" class="custom-input" required>
            <p id="senhaInvalida" class="senha-invalida">Senha inválida</p> <!-- Adicione esta linha -->
        </div>
        <button type="submit" class="custom-button">Login</button>
    </form>
</div>
<script>

        // Enviar os dados no formato JSON para o endpoint /usuario/login
        document.addEventListener("DOMContentLoaded", function() {
            const senhaInvalidaElement = document.getElementById("senhaInvalida");
            senhaInvalidaElement.style.display = "none"; // Começa oculto

            document.getElementById("loginForm").addEventListener("submit", function (e) {
                e.preventDefault();
                const email = document.getElementById("email").value;
                const password = document.getElementById("password").value;

                // Enviar os dados no formato JSON para o endpoint /usuario/login
                fetch("/usuario/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                })
                    .then(response => {
                        if (response.ok) {
                            // Login bem-sucedido, redirecione para a página desejada com parâmetros na URL
                            return response.text(); // Retornar a resposta como texto
                        } else {
                            senhaInvalidaElement.style.display = "block";
                            senhaInvalidaElement.textContent = "Senha incorreta"; // Mensagem de aviso
                            senhaInvalidaElement.style.color = "red"; // Cor vermelha
                            senhaInvalidaElement.style.marginTop = "5px"; // Espaçamento superior
                            setTimeout(() => {
                                senhaInvalidaElement.style.display = "none";
                            }, 3000); // Esconde após 3 segundos (ajuste conforme necessário)
                            throw new Error("Erro de login");
                        }
                    })
                    .then(data => {
                        // Separar a mensagem do nome do usuário
                        const parts = data.split('.'); // Você pode escolher um separador melhor
                        //const mensagem = parts[0];
                        const nomeUsuario = parts[1];

                        // Criar a URL com parâmetros
                        const dataHoraAtual = new Date();
                        const redirectURL = `/logado.html?nomeUsuario=${nomeUsuario}&dataHora=${dataHoraAtual}`;

                        // Redirecionar para a página desejada
                        window.location.href = redirectURL;
                    })
                    .catch(error => {
                        // Tratar erros de requisição
                        console.error("Erro na requisição:", error);
                    });
            });
        });




</script>


